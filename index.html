<!DOCTYPE html>
<html lang="fr">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8F7MY8T2TC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8F7MY8T2TC');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finance Personnelle Pro</title>

  <meta name="robots" content="index,follow">
  <link rel="canonical" href="https://parlonscash.pro/">

<style>
body {
  overflow-x: hidden;
}

.container {
  overflow: hidden;
}

.warning-box strong {
  display:flex;
  align-items:center;
  gap:8px;
  font-size:1em;
}

#tab-apropos .warning-box {
  display: none;
}

.danger-box strong {
  display:flex;
  align-items:center;
  gap:8px;
  font-size:1.05em;
}
.danger-box ul {
  margin:10px 0 0 20px;
  list-style:disc;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f3f4f6;color:#1f2937}
.container{max-width:1200px;margin:0 auto;padding:20px}
header{background:linear-gradient(135deg,#1e40af 0%,#1e40af 100%);color:white;padding:30px 20px}
.btn-export {
  background:#10b981;
  color:white;
  padding:10px 20px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
header h1{font-size:2em;margin-bottom:10px}
.nav{background:white;padding:15px 20px;margin-bottom:30px;display:flex;gap:10px;overflow-x:auto;flex-wrap:wrap}
.nav button{padding:10px 20px;border:none;background:#e5e7eb;color:#374151;border-radius:8px;cursor:pointer;font-size:14px}
.nav button.active{background:#2563eb;color:white}
.tab-content{display:none}
.tab-content.active{display:block}
.card{background:white;padding:25px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);margin-bottom:20px}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
.stat-card{background:white;padding:25px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
.stat-label{font-size:0.875em;color:#6b7280;margin-bottom:8px}
.stat-value{font-size:2em;font-weight:bold}
.blue{color:#2563eb}
.green{color:#10b981}
.red{color:#ef4444}
.purple{color:#8b5cf6}
.orange{color:#f97316}
.grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:25px}
.form-group{margin-bottom:20px}
.form-group label{display:block;font-size:0.875em;font-weight:500;color:#374151;margin-bottom:8px}
.form-group input,.form-group select{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:1em}
.total-row{padding-top:20px;border-top:2px solid #e5e7eb;margin-top:20px;display:flex;justify-content:space-between;font-weight:600}
.total-row .value{font-size:1.5em}
.summary-box{background:#eff6ff;padding:20px;border-radius:10px;margin-top:25px}
.summary-row{display:flex;justify-content:space-between;padding:10px 0}
.result-box{padding:20px;border-radius:10px;margin-bottom:15px}
.result-box.blue{background:#dbeafe}
.result-box.red{background:#fee2e2}
.result-box.orange{background:#fed7aa}
.result-box.purple{background:#ede9fe}
.result-box.green{background:#d1fae5}
.result-box.yellow{background:#fef3c7}
.progress-bar{background:#e5e7eb;height:20px;border-radius:10px;overflow:hidden;margin-top:10px}
.progress-fill{background:#10b981;height:100%;transition:width 0.3s}
.section-title{font-size:1.3em;color:#1f2937;margin:30px 0 15px 0;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:10px}
.hidden{display:none}
footer{background:#1f2937;color:white;text-align:center;padding:30px;margin-top:50px}

<style>
body {
  font-family: system-ui, sans-serif;
  color: #374151;
  background: #f9fafb;
}

h2, h3 {
  color: #1e3a8a;
  font-weight: 600;
}

.card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

input[type="number"] {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.95rem;
}

button, .tab-button {
  transition: background-color 0.2s ease, transform 0.1s ease;
}
button:hover, .tab-button:hover {
  transform: scale(1.03);
  background-color: #1e3a8a;
}

</style>
</head>
<body>
<header>
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
    <div>
      <h1>üí∞ Finance Personnelle Pro</h1>
      <p>G√©rez vos finances intelligemment</p>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn-export" onclick="exporterCSV()">üì• Exporter CSV</button>
      <button class="btn-export" style="background:#2563eb" onclick="window.print()">üñ®Ô∏è Exporter PDF</button>
    </div>
  </div>
</header>

<div class="nav">
<button onclick="changeTab('dashboard')" id="btn-dashboard" class="active">Tableau de bord</button>
<button onclick="changeTab('bilan')" id="btn-bilan">Bilan</button>
<button onclick="changeTab('budget')" id="btn-budget">Budget</button>
<button onclick="changeTab('impots')" id="btn-impots">Imp√¥ts</button>
<button onclick="changeTab('objectifs')" id="btn-objectifs">Objectifs</button>
<button onclick="changeTab('dettes')" id="btn-dettes">Remboursement dettes</button>
<button onclick="changeTab('apropos')" id="btn-apropos">√Ä propos</button>
<button onclick="changeTab('aide')" id="btn-aide">Aide √† la d√©cision</button>
<button onclick="changeTab('confidentialite')" id="btn-confidentialite">Confidentialit√©</button>

</div>

<div class="container">
<div id="tab-dashboard" class="tab-content active">

  <h2>Tableau de bord financier</h2>

  <div class="stats">
    <div class="stat-card"><div class="stat-label">Valeur nette</div><div class="stat-value blue" id="dash-valeur">0 $</div></div>
    <div class="stat-card"><div class="stat-label">Actifs totaux</div><div class="stat-value green" id="dash-actifs">0 $</div></div>
    <div class="stat-card"><div class="stat-label">Passifs totaux</div><div class="stat-value red" id="dash-passifs">0 $</div></div>
    <div class="stat-card"><div class="stat-label">Taux √©pargne</div><div class="stat-value purple" id="dash-taux">0%</div></div>
  </div>

  <div class="card">
    <h3>Diagnostic financier</h3>
    <div id="diagnostic-global">Entrez vos donn√©es pour un diagnostic</div>
  </div>

  <!-- Bandeau inspirant -->
  <div style="background:linear-gradient(135deg,#1e40af 0%,#1e40af 100%);
              color:white;
              padding:40px;
              border-radius:12px;
              margin-top:20px;
              text-align:center;">
    <h3 style="font-size:1.8em;font-weight:bold;color:white;">¬´ Parce que derri√®re chaque projet, il y a une vision √† r√©aliser. ¬ª</h3>
    <p style="margin-top:15px;font-size:1.1em;">
      Merci de faire partie de cette aventure. Continue √† construire, apprendre et avancer ‚Äî
      une d√©cision √©clair√©e √† la fois.
    </p>
  </div>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3695467180266092"
     crossorigin="anonymous"></script>

</div>

<div id="tab-bilan" class="tab-content">
<h2>Bilan personnel</h2>
<div class="grid-2">
<div class="card">
<h3 class="green">ACTIFS</h3>
<div class="form-group"><label>Compte bancaire</label><input type="number" id="cb" value="0" onchange="calc()"></div>
<div class="form-group"><label>CELI</label><input type="number" id="celi" value="0" onchange="calc()"></div>
<div class="form-group"><label>CELIAPP</label><input type="number" id="celiapp" value="0" onchange="calc()"></div>
<div class="form-group"><label>Compte non enregistre</label><input type="number" id="cne" value="0" onchange="calc()"></div>
<div class="form-group"><label>REER</label><input type="number" id="reer" value="0" onchange="calc()"></div>
<div class="form-group"><label>Immobilisations</label><input type="number" id="immob" value="0" onchange="calc()"></div>
<div class="form-group"><label>Autre</label><input type="number" id="autre-actif" value="0" onchange="calc()"></div>
<div class="total-row green"><span>Total actifs</span><span class="value" id="ta">0 $</span></div>
</div>
<div class="card">
<h3 class="red">PASSIFS</h3>
<div class="form-group"><label>Cartes de credit</label><input type="number" id="cc" value="0" onchange="calc()"></div>
<div class="form-group"><label>Marge de credit</label><input type="number" id="mc" value="0" onchange="calc()"></div>
<div class="form-group"><label>Pret automobile</label><input type="number" id="pa" value="0" onchange="calc()"></div>
<div class="form-group"><label>Hypotheque</label><input type="number" id="hypo" value="0" onchange="calc()"></div>
<div class="form-group"><label>Autre</label><input type="number" id="autre-passif" value="0" onchange="calc()"></div>
<div class="total-row red"><span>Total passifs</span><span class="value" id="tp">0 $</span></div>
<div class="summary-box"><div class="summary-row"><strong>Valeur nette</strong><strong class="blue" style="font-size:1.5em" id="vn">0 $</strong></div></div>
</div>
</div>
</div>

<div id="tab-budget" class="tab-content">
<h2>Budget mensuel</h2>
<div class="grid-2">
<div class="card">
<h3>Revenus</h3>
<div class="form-group"><label>Revenu mensuel net</label><input type="number" id="revenu" value="0" onchange="calc()"></div>
<div class="form-group"><label>Revenu de loyer</label><input type="number" id="rev-loyer" value="0" onchange="calc()"></div>
<div class="form-group"><label>Autre revenu</label><input type="number" id="autre-revenu" value="0" onchange="calc()"></div>
<h4 style="margin-top:20px">Depenses</h4>
<div class="form-group">
<label>Statut residentiel</label>
<select id="statut-resid" onchange="toggleHypotheque()">
<option value="locataire">Locataire</option>
<option value="proprio">Proprietaire</option>
</select>
</div>
<div class="form-group" id="loyer-group"><label>Loyer</label><input type="number" id="loyer" value="0" onchange="calc()"></div>
<div class="form-group hidden" id="hypo-group"><label>Paiement hypothecaire</label><input type="number" id="paiement-hypo" value="0" onchange="calc()"></div>
<div class="form-group hidden" id="taxes-proprio-group">
  <label>Taxes et entretien (mensuels)</label>
  <input type="number" id="taxes-entretien" value="0" onchange="calc()">
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Taxes municipales + scolaires + entretien moyen
  </small>
</div>
<div class="form-group"><label>Alimentation</label><input type="number" id="d2" value="0" onchange="calc()"></div>
<div class="form-group"><label>Transport</label><input type="number" id="d3" value="0" onchange="calc()"></div>
<div class="form-group"><label>Assurances</label><input type="number" id="d4" value="0" onchange="calc()"></div>
<div class="form-group"><label>Loisirs</label><input type="number" id="d5" value="0" onchange="calc()"></div>
<div class="form-group"><label>Autres</label><input type="number" id="d6" value="0" onchange="calc()"></div>
</div>
<div class="card">
<h3>Resume</h3>
<div class="summary-box">
<div class="summary-row"><span>Revenus totaux</span><strong id="rt">0 $</strong></div>
<div class="summary-row"><span>Total depenses</span><strong id="td">0 $</strong></div>
<div class="summary-row"><span>Epargne nette</span><strong class="green" id="en">0 $</strong></div>
<div class="summary-row"><span>Taux epargne</span><strong class="blue" id="te">0%</strong></div>
</div>
</div>
</div>
<div class="card">
<h3>Analyse budget 50-20-30</h3>
<p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:15px">Regle 50-20-30: 50% besoins essentiels, 20% epargne, 30% loisirs/desirs</p>
<div id="analyse-503020"></div>
</div>
<div class="card">
<h3>Fonds d'urgence</h3>
<p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:15px">Objectif: 3 √† 6 mois de depenses en compte bancaire</p>
<div id="resultat-fonds-urgence"></div>
</div>
</div>

<div id="tab-impots" class="tab-content">

  <!-- Encadr√© d‚Äôavertissement -->
  <div style="
    display:flex;
    align-items:flex-start;
    gap:12px;
    background:#fffaf0;
    border:1px solid #fcd34d;
    border-left:6px solid #f59e0b;
    padding:18px 22px;
    border-radius:10px;
    box-shadow:0 2px 4px rgba(0,0,0,0.05);
    margin-bottom:25px;
  ">
    <div style="font-size:26px;line-height:1;">‚ö†Ô∏è</div>
    <div style="color:#92400e;font-family:system-ui;">
      <strong style="font-size:1.1rem;">Avertissement important</strong><br>
      <p style="margin:6px 0 10px 0;">
        Le calcul ci-dessous est simplifi√© et ne tient pas compte des √©l√©ments suivants :
      </p>
      <ul style="margin:0 0 10px 20px; padding:0;">
        <li>Abattement du Qu√©bec (16.5%)</li>
        <li>Cr√©dits d‚Äôimp√¥t de base</li>
        <li>Cotisations RRQ, RQAP, Assurance-emploi</li>
        <li>D√©ductions sp√©cifiques (frais m√©dicaux, frais de garde, etc.)</li>
      </ul>
      <p style="margin:0;">
        üëâ Il est recommand√© de consulter un <strong>comptable</strong> ou un <strong>fiscaliste</strong>
        pour obtenir des calculs pr√©cis et adapt√©s √† votre situation.
      </p>
    </div>
  </div> <!-- ‚úÖ ici tu fermes l‚Äôencadr√© SEULEMENT -->

  <!-- Calculateur -->
  <h2>Calculateur d‚Äôimp√¥ts</h2>
  <p>Entrez vos informations pour estimer vos imp√¥ts :</p>
  <p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:15px">
    Calculs bas√©s sur les tranches d'imposition f√©d√©rales et provinciales du Qu√©bec pour 2025.
  </p>

  <div class="grid-2">
    <div class="card">
      <h3>Informations</h3>
      <div class="form-group"><label>Revenu brut annuel</label><input type="number" id="rb" value="0" onchange="calc()"></div>
      <div class="form-group"><label>Contribution REER</label><input type="number" id="cr" value="0" onchange="calc()"></div>
      <div class="form-group"><label>Autres d√©ductions</label><input type="number" id="ad" value="0" onchange="calc()"></div>
    </div>

    <div class="card">
      <h3>R√©sultats</h3>
      <div class="result-box blue"><div>Revenu imposable</div><div id="ri">0 $</div></div>
      <div class="result-box red"><div>Imp√¥t f√©d√©ral</div><div id="impf">0 $</div></div>
      <div class="result-box orange"><div>Imp√¥t provincial (QC)</div><div id="impp">0 $</div></div>
      <div class="result-box purple"><div>Imp√¥t total</div><div id="impt">0 $</div></div>
      <div class="result-box green"><div>Revenu net</div><div id="rn">0 $</div></div>
    </div>
  </div>

</div> <!-- ‚úÖ ici tu fermes le tab-impots -->

<div id="tab-objectifs" class="tab-content">
<h2>Objectifs et Projections</h2>

<div class="section-title">Achat d'une maison</div>
<div class="card">
  <div class="form-group">
    <label>Revenu brut annuel m√©nage ($)</label>
    <input type="number" id="revenu-brut-menage" value="0" onchange="calcImmobilier()">
  </div>
 <div class="form-group">
  <label>Mise de fonds (%)</label>
  <select id="mise-de-fonds-pct" onchange="calcImmobilier()">
    <option value="5">5%</option>
    <option value="10">10%</option>
    <option value="15">15%</option>
    <option value="20" selected>20%</option>
  </select>
</div> 
  <div class="form-group">
    <label>Taux hypoth√©caire (%)</label>
    <input type="number" id="taux-hypo" value="5" step="0.1" onchange="calcImmobilier()">
  </div>
<div class="form-group">
  <label>P√©riode d'amortissement (ann√©es)</label>
  <select id="amortissement" onchange="calcImmobilier()">
    <option value="25" selected>25 ans</option>
    <option value="26">26 ans</option>
    <option value="27">27 ans</option>
    <option value="28">28 ans</option>
    <option value="29">29 ans</option>
    <option value="30">30 ans</option>
  </select>
</div>

  <div class="form-group">
    <label>Prix de la maison envisag√©e ($)</label>
    <input type="number" id="prix-maison" value="0" onchange="calcImmobilier()">
  </div>

  <div id="resultat-immobilier"></div>
</div>

<div class="section-title">Epargne pour projet personnel</div>
<div class="card">
<p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:15px">Voyage, achat voiture, annee sabbatique, etudes... Calculez combien epargner mensuellement pour realiser votre projet.</p>
<div class="form-group"><label>Montant cible ($)</label><input type="number" id="obj-montant" value="50000" onchange="calc()"></div>
<div class="form-group"><label>Date cible</label><input type="date" id="obj-date" onchange="calc()"></div>
<div class="form-group">
  <label>Taux de rendement annuel (%)</label>
  <input type="number" id="taux-rendement-objectif" value="3" step="0.1" min="0" max="10" onchange="calc()">
  <small style="display:block;margin-top:5px;color:#6b7280;">Ex: 3% pour un compte √©pargne, 5-6% pour un placement √©quilibr√©</small>
</div>
<div id="resultat-objectif"></div>
</div>

<div class="section-title">Capital necessaire a la retraite</div>
<div class="card">
<p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:15px">Calculez le capital necessaire selon votre taux de retrait. Le revenu desire est ajuste automatiquement pour l'inflation (2% annuel).</p>
<div class="form-group"><label>Annees avant la retraite</label><input type="number" id="annees-retraite" value="30" onchange="calcRetraite()"></div>
<div class="form-group">
  <label>√Çge pr√©vu √† la retraite</label>
  <input type="number" id="age-retraite" value="65" onchange="calcRetraite()">
</div>
<div class="form-group">
  <label>Taux de rendement annuel avant retraite (%)</label>
  <input type="number" id="taux-rendement-avant-retraite" value="5" step="0.5" min="0" max="12" onchange="calcRetraite()">
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Ex: 3-4% conservateur, 5-6% √©quilibr√©, 7-8% croissance
  </small>
</div>
<div class="form-group">
  <label>Taux de rendement pendant la retraite (%)</label>
  <input type="number" id="taux-rendement-pendant-retraite" value="5" step="0.5" min="0" max="20" onchange="calcRetraite()">
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Rendement pr√©vu sur vos placements une fois √† la retraite
  </small>
</div>
<div class="form-group">
  <label>Revenu de pension estim√© (RRQ + PSV)</label>
  <input type="number" id="pension-publique" value="0" onchange="calcRetraite()">
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Estimation 2025 : RRQ max ~15 600$/an, PSV ~8 600$/an (si 65 ans+)
  </small>
</div>
<div class="form-group">
  <label>Rente de fonds de pension (employeur)</label>
  <input type="number" id="rente-pension" value="0" onchange="calcRetraite()">
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Revenu annuel estim√© de votre r√©gime de retraite d'employeur (si applicable)
  </small>
</div>
<div class="form-group"><label>Revenu annuel desire (en dollars d'aujourd'hui)</label><input type="number" id="revenu-retraite" value="50000" onchange="calcRetraite()"></div>
<div class="form-group">
  <label style="display:flex;align-items:center;gap:10px;">
    <input type="checkbox" id="contribution-actuelle-toggle" onchange="toggleContributionActuelle()" style="width:auto;">
    <span>üí° J'√©pargne d√©j√† pour ma retraite</span>
  </label>
</div>

<div id="contribution-actuelle-section" class="hidden" style="background:#f0f9ff;padding:15px;border-radius:8px;margin:10px 0;">
  <div class="form-group">
    <label>Contribution mensuelle actuelle ($)</label>
    <input type="number" id="contribution-mensuelle-actuelle" value="0" onchange="calcRetraite()">
    <small style="display:block;margin-top:5px;color:#6b7280;">
      Combien √©pargnez-vous actuellement par mois pour votre retraite ?
    </small>
  </div>
</div
<div class="form-group">
  <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
    <input type="checkbox" id="retrait-indexe" onchange="calcRetraite()" checked style="width:auto;">
    <span>Indexer les retraits √† l'inflation (3% annuel)</span>
  </label>
  <small style="display:block;margin-top:5px;color:#6b7280;">
    Si coch√©, vos retraits augmenteront de 3% par an pour maintenir votre pouvoir d'achat
  </small>
</div>
<div id="resultat-retraite"></div>
</div>
</div>

</div>

</div> <!-- Fin de tab-objectifs -->

<div id="tab-dettes" class="tab-content">
   <h2>Calculateur de remboursement de dettes</h2>
  
  <p style="background:#fef3c7;padding:15px;border-radius:8px;margin-bottom:20px;">
    Comparez deux strat√©gies populaires : <strong>Avalanche</strong> (rembourse d'abord les taux √©lev√©s - √©conomise plus d'int√©r√™ts) 
    et <strong>Boule de neige</strong> (rembourse d'abord les petits soldes - motivation psychologique).
  </p>

  <div class="card">
    <h3>Vos dettes</h3>
    <div id="liste-dettes-container"></div>
    
    <button onclick="ajouterLigneDette()" style="background:#2563eb;color:white;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;margin-top:15px;">
      ‚ûï Ajouter une dette
    </button>
  </div>

  <div class="card">
    <h3>Paiement mensuel suppl√©mentaire</h3>
    <div class="form-group">
      <label>Montant mensuel disponible (au-del√† des minimums)</label>
      <input type="number" id="paiement-extra" value="0" min="0" onchange="calculerStrategies()">
      <small style="display:block;margin-top:5px;color:#6b7280;">
        Combien pouvez-vous allouer mensuellement en plus des paiements minimums ?
      </small>
    </div>
    
    <button onclick="calculerStrategies()" style="background:#10b981;color:white;padding:12px 30px;border:none;border-radius:8px;cursor:pointer;margin-top:15px;font-weight:bold;">
      üìä Calculer les strat√©gies
    </button>
  </div>

  <div id="resultats-strategies"></div>
</div>
</div>

<!-- Onglet √Ä propos -->
<div id="tab-apropos" class="tab-content">
  <h2>√Ä propos</h2>

<div class="card" style="display:flex;align-items:center;gap:20px;flex-wrap:wrap;">
  <img src="Aziz Guellouz.jpg" alt="Photo de Aziz Guellouz" 
       style="width:180px;height:180px;object-fit:cover;border-radius:50%;border:4px solid #2563eb;">
  
  <div>
    <h3 style="color:#92400e;">Bienvenue</h3>
    <p style="margin-top:10px;">
      Je m'appelle <strong>Aziz Guellouz</strong> et je me passionne pour tout ce qui touche √† la 
      <strong>finance, la strat√©gie et l'accompagnement des entrepreneurs</strong>.
      <br><br>
      Depuis plusieurs ann√©es, j'√©volue au c≈ìur du d√©veloppement √©conomique de Montr√©al, o√π j'ai accompagn√© 
      de nombreuses entreprises √† structurer leurs projets, renforcer leur gestion financi√®re 
      et acc√©der aux bons leviers de financement.
      <br><br>
      Mon approche est simple : allier <strong>rigueur</strong>, <strong>clart√©</strong> et 
      <strong>impact concret</strong> pour aider les gens √† transformer leurs ambitions en r√©sultats durables.
    </p>
  </div>
</div>

  <div class="card" style="background:#eff6ff;">
    <h3 style="color:#1e3a8a;">Mes valeurs</h3>
    <ul style="margin-top:10px;line-height:1.8em;">
      <li><strong>Rigueur</strong> ‚Äì Parce qu'un bon conseil repose sur des faits solides.</li>
      <li><strong>Transparence</strong> ‚Äì Dire les choses telles qu'elles sont, avec respect et honn√™tet√©.</li>
      <li><strong>Impact local</strong> ‚Äì Contribuer concr√®tement √† la vitalit√© √©conomique de Montr√©al.</li>
      <li><strong>Innovation utile</strong> ‚Äì Cr√©er des outils simples qui font gagner du temps et de la clart√©.</li>
    </ul>
  </div>
  
</div>

<div class="warning-box" style="background:#fef2f2;border-left:6px solid #dc2626;padding:25px;border-radius:12px;margin-bottom:30px;overflow:hidden;">
  <strong style="color:#991b1b;font-size:1.1em;">‚ö†Ô∏è Avertissement important</strong>
  
 <p style="margin:10px 0 10px 0;padding:0;line-height:1.7;color:#7f1d1d;text-align:left;"><strong>Cet outil est √† des fins √©ducatives et informatives seulement.</strong> Les calculs, projections et suggestions pr√©sent√©s sont des estimations simplifi√©es bas√©es sur des principes financiers g√©n√©ralement reconnus. <strong>Ils ne constituent en aucun cas des conseils financiers, fiscaux ou juridiques personnalis√©s.</strong></p>

<p style="margin:10px 0 10px 0;padding:0;line-height:1.7;color:#7f1d1d;text-align:left;">Chaque situation financi√®re est unique. Avant de prendre toute d√©cision financi√®re importante, consultez un conseiller financier autoris√©, un fiscaliste ou un planificateur financier certifi√©.</p>
  
  </p>
  
  <div style="margin-top:15px;padding-top:15px;border-top:1px solid #fca5a5;">
    <strong style="color:#991b1b;">üìö Ressources officielles :</strong>
    <ul style="margin:10px 0 0 20px;line-height:2;color:#7f1d1d;list-style-position:outside;padding-left:0;">
      <li style="margin-bottom:8px;"><a href="https://www.retraitequebec.gouv.qc.ca/" target="_blank" style="color:#1e40af;text-decoration:underline;">Retraite Qu√©bec</a> - Informations sur le RRQ et la retraite</li>
      <li style="margin-bottom:8px;"><a href="https://lautorite.qc.ca/" target="_blank" style="color:#1e40af;text-decoration:underline;">Autorit√© des march√©s financiers (AMF)</a> - √âducation financi√®re et protection</li>
      <li style="margin-bottom:8px;"><a href="https://www.canada.ca/fr/services/prestations/pensionspubliques.html" target="_blank" style="color:#1e40af;text-decoration:underline;">Gouvernement du Canada</a> - Programmes de retraite publics</li>
    </ul>
  </div>
</div>

<!-- Onglet : Aide √† la d√©cision -->
<div id="tab-aide" class="tab-content">

  <h2>üí° Aide √† la d√©cision : CELI ou REER ?</h2>

  <p>Voici un aper√ßu comparatif des deux principaux r√©gimes d‚Äô√©pargne au Canada.</p>

  <table style="width:100%;border-collapse:collapse;margin-top:18px;font-size:0.95rem;">
    <thead style="background:#f9fafb;">
      <tr>
        <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">Aspect</th>
        <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">CELI</th>
        <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">REER</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Objectif</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Croissance libre d‚Äôimp√¥t ‚Äî id√©al pour flexibilit√© et retraits √† court ou moyen terme.</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Report d‚Äôimp√¥t ‚Äî avantageux si votre taux d‚Äôimposition est plus bas √† la retraite.</td>
      </tr>
      <tr>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Retraits</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Non imposables et sans impact fiscal.</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Imposables selon votre taux au moment du retrait.</td>
      </tr>
      <tr>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Cotisations</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Non d√©ductibles, mais rendement non imposable.</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">D√©ductibles du revenu imposable, r√©duisent l‚Äôimp√¥t pay√© cette ann√©e.</td>
      </tr>
      <tr>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">Plafond annuel (2025)</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">7 000 $ (droits cumulatifs si non utilis√©s).</td>
        <td style="padding:10px;border-bottom:1px solid #e5e7eb;">18 % du revenu gagn√©, jusqu‚Äô√† un maximum de 31 560 $.</td>
      </tr>
    </tbody>
  </table>

  <p style="margin-top:20px;">
    üí¨ <strong>Astuce :</strong> Comparez votre taux d‚Äôimposition actuel et celui anticip√© √† la retraite.
    Si votre taux futur est plus √©lev√©, le CELI peut √™tre avantageux ; s‚Äôil est plus bas, le REER peut
    offrir un meilleur report d‚Äôimp√¥t.  
    Ces informations visent √† <strong>√©clairer</strong> votre r√©flexion, pas √† d√©terminer un choix.
  </p>

  <!-- ‚ö†Ô∏è Avertissement plac√© √† la fin -->
  <div style="
    background:#fff8e1;
    border:1px solid #fcd34d;
    border-left:6px solid #f59e0b;
    padding:18px 22px;
    border-radius:10px;
    margin-top:40px;
    color:#78350f;
    line-height:1.5;
  ">
    ‚ö†Ô∏è <strong>Avertissement :</strong> Les informations pr√©sent√©es sur cette page sont fournies
    √† titre informatif seulement et ne constituent pas des conseils financiers personnalis√©s.
    Chaque situation est unique ‚Äî consultez un professionnel avant de prendre une d√©cision
    d‚Äôinvestissement.
  </div>

</div>

<div id="tab-confidentialite" class="tab-content">
  <h2>Politique de confidentialit√©</h2>
  
  <div class="card">
    <p style="margin-bottom:20px;"><em>Derni√®re mise √† jour : Octobre 2025</em></p>
    
    <h3 style="color:#2563eb;margin-top:0;">Notre engagement</h3>
    <p style="line-height:1.7;">
      Finance Personnelle Pro respecte votre vie priv√©e. Cette politique explique quelles donn√©es sont collect√©es 
      lorsque vous utilisez notre site et comment elles sont utilis√©es.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üíæ Vos donn√©es financi√®res</h3>
    <div style="background:#d1fae5;padding:15px;border-radius:8px;border-left:4px solid #10b981;margin:15px 0;">
      <p style="margin:0;font-weight:600;color:#065f46;">
        ‚úÖ AUCUNE de vos donn√©es financi√®res personnelles (revenus, dettes, actifs, etc.) n'est envoy√©e √† nos serveurs ou stock√©e en ligne.
      </p>
    </div>
    <p style="line-height:1.7;">
      Toutes les donn√©es que vous entrez dans les calculateurs restent <strong>localement dans votre navigateur</strong>. 
      Nous n'avons aucun acc√®s √† ces informations sensibles.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üìä Google Analytics</h3>
    <p style="line-height:1.7;">
      Nous utilisons Google Analytics pour comprendre comment les visiteurs utilisent notre site et l'am√©liorer. 
      Les donn√©es collect√©es incluent :
    </p>
    <ul style="line-height:1.8;margin-left:20px;">
      <li>Pages visit√©es et dur√©e de visite</li>
      <li>Localisation g√©ographique approximative (ville/r√©gion)</li>
      <li>Type d'appareil et navigateur utilis√©</li>
      <li>Adresse IP (anonymis√©e)</li>
    </ul>
    <p style="line-height:1.7;">
      Ces donn√©es sont <strong>anonymes</strong> et ne permettent pas de vous identifier personnellement.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üéØ Publicit√© (Google AdSense)</h3>
    <p style="line-height:1.7;">
      Nous utilisons Google AdSense pour afficher des publicit√©s qui financent ce site gratuit. 
      Google et ses partenaires publicitaires utilisent des cookies pour :
    </p>
    <ul style="line-height:1.8;margin-left:20px;">
      <li>Personnaliser les publicit√©s selon vos centres d'int√©r√™t</li>
      <li>Mesurer l'efficacit√© des publicit√©s</li>
      <li>Limiter le nombre de fois qu'une publicit√© vous est montr√©e</li>
    </ul>
    <p style="line-height:1.7;">
      Vous pouvez g√©rer vos pr√©f√©rences publicitaires sur 
      <a href="https://adssettings.google.com" target="_blank" style="color:#2563eb;">Google Ads Settings</a>.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üç™ Cookies</h3>
    <p style="line-height:1.7;">
      Notre site utilise des cookies pour Google Analytics et AdSense. Vous pouvez bloquer ou supprimer les cookies 
      via les param√®tres de votre navigateur. Cela n'affectera pas le fonctionnement des calculateurs.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üîí S√©curit√©</h3>
    <p style="line-height:1.7;">
      Comme nous ne collectons ni ne stockons vos donn√©es financi√®res personnelles, il n'y a aucun risque de fuite 
      de ces informations sensibles depuis notre site.
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">‚öñÔ∏è Vos droits</h3>
    <p style="line-height:1.7;">
      Conform√©ment aux lois canadiennes (LPRPDE) et europ√©ennes (RGPD), vous avez le droit de :
    </p>
    <ul style="line-height:1.8;margin-left:20px;">
      <li>Refuser les cookies (via les param√®tres de votre navigateur)</li>
      <li>Demander l'acc√®s aux donn√©es que nous d√©tenons (Analytics anonyme uniquement)</li>
      <li>Utiliser notre site sans accepter les cookies publicitaires</li>
    </ul>
    
    <h3 style="color:#2563eb;margin-top:30px;">üìß Contact</h3>
    <p style="line-height:1.7;">
      Pour toute question concernant cette politique de confidentialit√©, vous pouvez nous contacter √† : 
      <a href="mailto:azizguellouz@gmail.com" style="color:#2563eb;">azizguellouz@gmail.com</a>
    </p>
    
    <h3 style="color:#2563eb;margin-top:30px;">üîÑ Modifications</h3>
    <p style="line-height:1.7;">
      Nous pouvons mettre √† jour cette politique de confidentialit√© occasionnellement. 
      La date de derni√®re mise √† jour est indiqu√©e en haut de cette page.
    </p>
  </div>
  
  <div class="card" style="background:#eff6ff;margin-top:20px;">
    <h3 style="color:#1e40af;margin-top:0;">üìö Ressources utiles</h3>
    <ul style="line-height:2;">
      <li><a href="https://policies.google.com/privacy" target="_blank" style="color:#2563eb;">Politique de confidentialit√© de Google</a></li>
      <li><a href="https://www.priv.gc.ca/fr/" target="_blank" style="color:#2563eb;">Commissariat √† la protection de la vie priv√©e du Canada</a></li>
      <li><a href="https://support.google.com/analytics/answer/6004245" target="_blank" style="color:#2563eb;">Comment Google Analytics prot√®ge vos donn√©es</a></li>
    </ul>
  </div>
</div>

<footer style="background:#1f2937;color:white;padding:40px 20px;margin-top:50px;">
  <div class="container">
     <div style="text-align:center;color:#9ca3af;">
      <p style="margin:0 0 10px 0;font-size:1em;">Finance Personnelle Pro</p>
      <p style="margin:0;font-size:0.85em;">¬© 2025 Aziz Guellouz. Tous droits r√©serv√©s.</p>
      <p style="margin:10px 0 0 0;font-size:0.8em;">
        Le code source et les calculateurs de ce site sont la propri√©t√© intellectuelle d'Aziz Guellouz. 
        Toute reproduction ou utilisation non autoris√©e est interdite.
      </p>
    </div>
  </div>
</footer>

<script>
var DATA={};

function changeTab(t){
  var tabs=document.querySelectorAll('.tab-content');
  for(var i=0;i<tabs.length;i++){tabs[i].classList.remove('active');}
  document.getElementById('tab-'+t).classList.add('active');

  var btns=document.querySelectorAll('.nav button');
  for(var i=0;i<btns.length;i++){btns[i].classList.remove('active');}
  document.getElementById('btn-'+t).classList.add('active');

  // üëá AJOUT : cacher les bandeaux sur AIDE aussi
  var warnings = document.querySelectorAll('.warning-box, .danger-box');
  for(var i = 0; i < warnings.length; i++) {
    if(t === 'apropos' || t === 'confidentialite' || t === 'aide') {
      warnings[i].style.display = 'none';
    } else {
      warnings[i].style.display = 'block';
    }
  }
}

function fmt(n){return Math.round(n).toLocaleString('fr-CA');}

function toggleHypotheque(){
var statut=document.getElementById('statut-resid').value;
if(statut==='proprio'){
  document.getElementById('loyer-group').classList.add('hidden');
  document.getElementById('hypo-group').classList.remove('hidden');
  document.getElementById('taxes-proprio-group').classList.remove('hidden'); // ‚Üê AJOUTER
}else{
  document.getElementById('loyer-group').classList.remove('hidden');
  document.getElementById('hypo-group').classList.add('hidden');
  document.getElementById('taxes-proprio-group').classList.add('hidden'); // ‚Üê AJOUTER
}
calc();
}

function calc(){
var a1=parseFloat(document.getElementById('cb').value)||0;
var a2=parseFloat(document.getElementById('celi').value)||0;
var a2b=parseFloat(document.getElementById('celiapp').value)||0;
var a3=parseFloat(document.getElementById('cne').value)||0;
var a3=parseFloat(document.getElementById('cne').value)||0;
var a4=parseFloat(document.getElementById('reer').value)||0;
var a5=parseFloat(document.getElementById('immob').value)||0;
var a6=parseFloat(document.getElementById('autre-actif').value)||0;
var p1=parseFloat(document.getElementById('cc').value)||0;
var p2=parseFloat(document.getElementById('mc').value)||0;
var p3=parseFloat(document.getElementById('pa').value)||0;
var p4=parseFloat(document.getElementById('hypo').value)||0;
var p5=parseFloat(document.getElementById('autre-passif').value)||0;
DATA.totalA=a1+a2+a2b+a3+a4+a5+a6;
DATA.totalP=p1+p2+p3+p4+p5;
DATA.vn=DATA.totalA-DATA.totalP;
DATA.cb=a1;
DATA.liquidite=a1+a2+a2b;

document.getElementById('ta').textContent=fmt(DATA.totalA)+' $';
document.getElementById('tp').textContent=fmt(DATA.totalP)+' $';
document.getElementById('vn').textContent=fmt(DATA.vn)+' $';
document.getElementById('dash-valeur').textContent=fmt(DATA.vn)+' $';
document.getElementById('dash-actifs').textContent=fmt(DATA.totalA)+' $';
document.getElementById('dash-passifs').textContent=fmt(DATA.totalP)+' $';

if(a4 > 0){
  var tauxMarginal = 0.40;
  var impotLatent = a4 * tauxMarginal;
  var reerNet = a4 - impotLatent;
  var valeurNetteAjustee = DATA.vn - impotLatent;
  
  var htmlReer = '<div class="result-box yellow" style="margin-top:15px;">';
  htmlReer += '<strong>üí° Imp√¥t latent sur REER</strong><br>';
  htmlReer += '<small style="display:block;margin:8px 0;line-height:1.6;">Les retraits REER sont impos√©s comme du revenu ordinaire. Voici une estimation de l\'impact fiscal :</small>';
  htmlReer += '<p style="margin:5px 0;">REER brut: ' + fmt(a4) + ' $</p>';
  htmlReer += '<p style="margin:5px 0;color:#dc2626;">Imp√¥t estim√© (40%): -' + fmt(impotLatent) + ' $</p>';
  htmlReer += '<p style="margin:5px 0;font-weight:bold;color:#047857;">Valeur REER nette estim√©e: ' + fmt(reerNet) + ' $</p>';
  htmlReer += '<p style="margin:10px 0;padding-top:10px;border-top:1px solid #f59e0b;font-weight:bold;color:#1e40af;">Valeur nette ajust√©e: ' + fmt(valeurNetteAjustee) + ' $</p>';
  htmlReer += '<small style="display:block;margin-top:8px;color:#78350f;">Cette estimation suppose un taux marginal de 40%. Le taux r√©el d√©pendra de votre revenu et strat√©gie de retrait √† la retraite.</small>';
  htmlReer += '</div>';
  
  // Ins√©rer dans le DOM (apr√®s la summary-box de valeur nette)
  var summaryBox = document.querySelector('#tab-bilan .summary-box');
  if(summaryBox && !document.getElementById('info-reer')){
    var infoDiv = document.createElement('div');
    infoDiv.id = 'info-reer';
    infoDiv.innerHTML = htmlReer;
    summaryBox.parentNode.insertBefore(infoDiv, summaryBox.nextSibling);
  } else if(document.getElementById('info-reer')) {
    document.getElementById('info-reer').innerHTML = htmlReer;
  }
} else {
  // Supprimer l'info si REER = 0
  var infoReer = document.getElementById('info-reer');
  if(infoReer) infoReer.remove();
}
var rev=parseFloat(document.getElementById('revenu').value)||0;
var revLoyer=parseFloat(document.getElementById('rev-loyer').value)||0;
var autreRev=parseFloat(document.getElementById('autre-revenu').value)||0;
DATA.revenuTotal=rev+revLoyer+autreRev;

var statut=document.getElementById('statut-resid').value;
var d1=statut==='proprio'?
  ((parseFloat(document.getElementById('paiement-hypo').value)||0) + 
   (parseFloat(document.getElementById('taxes-entretien').value)||0))
  :(parseFloat(document.getElementById('loyer').value)||0);
var d2=parseFloat(document.getElementById('d2').value)||0;
var d3=parseFloat(document.getElementById('d3').value)||0;
var d4=parseFloat(document.getElementById('d4').value)||0;
var d5=parseFloat(document.getElementById('d5').value)||0;
var d6=parseFloat(document.getElementById('d6').value)||0;
DATA.totalD=d1+d2+d3+d4+d5+d6;
DATA.epargne=DATA.revenuTotal-DATA.totalD;
DATA.taux=DATA.revenuTotal>0?((DATA.epargne/DATA.revenuTotal)*100).toFixed(1):0;

document.getElementById('rt').textContent=fmt(DATA.revenuTotal)+' $';
document.getElementById('td').textContent=fmt(DATA.totalD)+' $';
document.getElementById('en').textContent=fmt(DATA.epargne)+' $';
document.getElementById('te').textContent=DATA.taux+'%';
document.getElementById('dash-taux').textContent=DATA.taux+'%';

calcImpots();
calcObjectif();
calcRetraite();
calcImmobilier();
calcFondsUrgence();
calc503020();
genererDiagnostic();
}

function calcImpots(){
var rb=parseFloat(document.getElementById('rb').value)||0;
var cr=parseFloat(document.getElementById('cr').value)||0;
var ad=parseFloat(document.getElementById('ad').value)||0;
var ri=Math.max(0,rb-cr-ad);

// IMP√îT F√âD√âRAL 2025 (tranches corrig√©es)
var impf=0;
if(ri<=55867){
  impf=ri*0.15;
}else if(ri<=111733){
  impf=55867*0.15+(ri-55867)*0.205;
}else if(ri<=173205){
  impf=55867*0.15+(111733-55867)*0.205+(ri-111733)*0.26;
}else if(ri<=246752){
  impf=55867*0.15+(111733-55867)*0.205+(173205-111733)*0.26+(ri-173205)*0.29;
}else{
  impf=55867*0.15+(111733-55867)*0.205+(173205-111733)*0.26+(246752-173205)*0.29+(ri-246752)*0.33;
}

// IMP√îT PROVINCIAL QU√âBEC 2025 (tranches corrig√©es)
var impp=0;
if(ri<=51780){
  impp=ri*0.14;
}else if(ri<=103545){
  impp=51780*0.14+(ri-51780)*0.19;
}else if(ri<=126000){
  impp=51780*0.14+(103545-51780)*0.19+(ri-103545)*0.24;
}else{
  impp=51780*0.14+(103545-51780)*0.19+(126000-103545)*0.24+(ri-126000)*0.2575;
}

var impt=impf+impp;
var rn = ri - impt;
document.getElementById('ri').textContent=fmt(ri)+' $';
document.getElementById('impf').textContent=fmt(impf)+' $';
document.getElementById('impp').textContent=fmt(impp)+' $';
document.getElementById('impt').textContent=fmt(impt)+' $';
document.getElementById('rn').textContent=fmt(rn)+' $';
}

function calc503020(){
var rev=DATA.revenuTotal||0;
if(rev<=0){
document.getElementById('analyse-503020').innerHTML='<p>Entrez votre revenu mensuel dans l\'onglet Budget.</p>';
return;
}
var besoin50=rev*0.5;
var epargne20=rev*0.2;
var desirs30=rev*0.3;
var html='<div style="margin:20px 0">';
html+='<div style="margin:10px 0"><strong>Besoins (50%):</strong> '+fmt(besoin50)+' $ recommand√©s</div>';
html+='<div class="progress-bar"><div class="progress-fill" style="width:50%;background:#3b82f6"></div></div>';
html+='<div style="margin:10px 0;margin-top:20px"><strong>√âpargne (20%):</strong> '+fmt(epargne20)+' $ recommand√©s';
var epargneActuelle=DATA.epargne||0;
var pourc=rev>0?(epargneActuelle/rev*100):0;
html+=' (Actuel: '+fmt(epargneActuelle)+' $ = '+pourc.toFixed(1)+'%)</div>';
html+='<div class="progress-bar"><div class="progress-fill" style="width:20%;background:#10b981"></div></div>';
html+='<div style="margin:10px 0;margin-top:20px"><strong>D√©sirs (30%):</strong> '+fmt(desirs30)+' $ recommand√©s</div>';
html+='<div class="progress-bar"><div class="progress-fill" style="width:30%;background:#f59e0b"></div></div>';
html+='</div>';
if(epargneActuelle>=epargne20){
html+='<div class="result-box green">‚úÖ F√©licitations! Vous atteignez l\'objectif d\'√©pargne de 20%.</div>';
}else{
var deficit=epargne20-epargneActuelle;
html+='<div class="result-box orange">‚ö†Ô∏è Attention: Il vous manque '+fmt(deficit)+' $ pour atteindre les 20% d\'√©pargne recommand√©s.</div>';
}
document.getElementById('analyse-503020').innerHTML=html;
}

function calcFondsUrgence(){
var fonds=DATA.cb||0;
var depenses=DATA.totalD||1;
var mois=fonds/depenses;
var c3=depenses*3;
var c6=depenses*6;
var html='<div class="result-box '+(mois>=6?'green':mois>=3?'orange':'red')+'">';
html+='Fonds actuel: '+fmt(fonds)+' $ ('+mois.toFixed(1)+' mois)</div>';
html+='<div class="result-box blue">Objectif min (3 mois): '+fmt(c3)+' $<br>Objectif optimal (6 mois): '+fmt(c6)+' $';
var prog=(fonds/c6*100);
html+='<div class="progress-bar" style="margin-top:10px"><div class="progress-fill" style="width:'+Math.min(prog,100)+'%"></div></div></div>';
document.getElementById('resultat-fonds-urgence').innerHTML=html;
}

function toggleContributionActuelle() {
  var checked = document.getElementById('contribution-actuelle-toggle').checked;
  var section = document.getElementById('contribution-actuelle-section');
  if(checked) {
    section.classList.remove('hidden');
  } else {
    section.classList.add('hidden');
    document.getElementById('contribution-mensuelle-actuelle').value = 0;
  }
  calcRetraite();
}

function calcRetraite() {
  var revRet = parseFloat(document.getElementById('revenu-retraite').value) || 50000;
  var annees = parseFloat(document.getElementById('annees-retraite').value) || 30;
  var ageRetraite = parseFloat(document.getElementById('age-retraite').value) || 65;
  var pensionPublique = parseFloat(document.getElementById('pension-publique').value) || 0;
  var rentePension = parseFloat(document.getElementById('rente-pension').value) || 0;
  var tauxRendementAvant = (parseFloat(document.getElementById('taux-rendement-avant-retraite').value) || 5) / 100;
  var tauxRendementPendant = (parseFloat(document.getElementById('taux-rendement-pendant-retraite').value) || 5) / 100;
  var retraitIndexe = document.getElementById('retrait-indexe').checked;

  var tauxInflation = 0.03;
  
  // Ajustement du revenu pour l'inflation
  var revenuAjuste = revRet * Math.pow(1 + tauxInflation, annees);

  // Pension publique disponible seulement si retraite √† 60 ans minimum
  var pensionDisponible = (ageRetraite >= 60) ? pensionPublique : 0;
  var pensionAjustee = pensionDisponible * Math.pow(1 + tauxInflation, annees);

  // Rente de pension (employeur)
  var rentePensionAjustee = rentePension * Math.pow(1 + tauxInflation, annees);
  
  // Revenu √† combler par l'√©pargne personnelle
  var revenuACombler = Math.max(0, revenuAjuste - pensionAjustee - rentePensionAjustee);
  var revenuACompleterActuel = Math.max(0, revRet - pensionDisponible - rentePension);

  // CALCUL DU CAPITAL N√âCESSAIRE (formule de rente)
  // On suppose une retraite de 30 ans (65 √† 95 ans)
  var dureeRetraite = 30;
  var tauxReel = tauxRendementPendant - tauxInflation; // Taux r√©el apr√®s inflation
  
  var capitalNecessaire;
  if (tauxReel > 0.001) {
    // Formule de la valeur actualis√©e d'une rente croissante
    if (retraitIndexe) {
      // Avec indexation : les retraits augmentent avec l'inflation
      capitalNecessaire = revenuACompleterActuel * ((1 - Math.pow(1 + tauxReel, -dureeRetraite)) / tauxReel);
    } else {
      // Sans indexation : retraits constants
      var facteur = (1 - Math.pow(1 + tauxRendementPendant, -dureeRetraite)) / tauxRendementPendant;
      capitalNecessaire = revenuACompleterActuel * facteur;
    }
  } else {
    // Si taux r√©el ~ 0, calcul simple
    capitalNecessaire = revenuACompleterActuel * dureeRetraite;
  }

  // Capital liquide actuel (CELI, CELIAPP, CNE, REER)
  var capAct = 
    (parseFloat(document.getElementById('celi').value) || 0) +
    (parseFloat(document.getElementById('celiapp').value) || 0) +
    (parseFloat(document.getElementById('cne').value) || 0) +
    (parseFloat(document.getElementById('reer').value) || 0);

  // Valeur future du capital actuel
  var valeurFuture = capAct * Math.pow(1 + tauxRendementAvant, annees);
// Contribution actuelle (optionnelle)
var contributionMensuelle = parseFloat(document.getElementById('contribution-mensuelle-actuelle').value) || 0;
var valeurFutureAvecContributions = valeurFuture;

if(contributionMensuelle > 0) {
  var tauxMensuel = tauxRendementAvant / 12;
  var mois = annees * 12;
  // Valeur future des contributions mensuelles
  var valeurContributions = contributionMensuelle * ((Math.pow(1 + tauxMensuel, mois) - 1) / tauxMensuel);
  valeurFutureAvecContributions = valeurFuture + valeurContributions;
}
  var ecart = Math.max(0, capitalNecessaire - valeurFuture);
  var prog = (valeurFuture / capitalNecessaire * 100);

  // SIMULATION ANN√âE PAR ANN√âE pour trouver l'√¢ge d'√©puisement
  var capitalSimulation = valeurFuture;
  var retraitAnnuel = revenuACompleterActuel;
  var ageEpuisement = null;

  for (var i = 0; i <= 95 - ageRetraite && capitalSimulation > 0; i++) {
    if (retraitIndexe && i > 0) retraitAnnuel *= (1 + tauxInflation);
    var gain = capitalSimulation * tauxRendementPendant;
    capitalSimulation = capitalSimulation + gain - retraitAnnuel;
    if (capitalSimulation <= 0 && ageEpuisement === null) {
      ageEpuisement = ageRetraite + i;
    }
  }

  // CONSTRUCTION DU HTML
  var html = '';
  html += '<div class="result-box green">Capital n√©cessaire √† la retraite: <span style="font-size:1.8em">' + fmt(capitalNecessaire) + ' $</span></div>';
  html += '<p style="margin-top:6px;font-size:0.9em;color:#6b7280;">üí° Ce calcul consid√®re uniquement vos actifs financiers liquides (CELI, CELIAPP, CNE, REER). Les immobilisations et le compte bancaire ne sont pas inclus.</p>';

  html += '<p style="margin:10px 0;font-size:0.9em;color:#6b7280">';
  html += 'Revenu d√©sir√©: ' + fmt(revRet) + ' $ ‚Üí Ajust√© inflation: ' + fmt(revenuAjuste) + ' $<br>';
  if (pensionPublique > 0 || rentePension > 0) {
    if (pensionPublique > 0) {
      html += 'Pension publique (RRQ+PSV): ' + fmt(pensionPublique) + ' $';
      if (ageRetraite < 60) html += ' <strong style="color:#dc2626;">(Non disponible avant 60 ans)</strong>';
      html += '<br>';
    }
    if (rentePension > 0) html += 'Rente de pension (employeur): ' + fmt(rentePension) + ' $<br>';
    html += '<strong>Revenu √† combler par √©pargne: ' + fmt(revenuACompleterActuel) + ' $</strong><br>';
  }
  html += 'Dur√©e de retraite pr√©vue: ' + dureeRetraite + ' ans (jusqu\'√† ' + (ageRetraite + dureeRetraite) + ' ans)<br>';
  html += 'Rendement pendant la retraite: ' + fmt(tauxRendementPendant * 100) + '%';
  html += '</p>';

  if (capAct > 0) {
    html += '<div class="result-box blue">';
    html += '<strong>üí∞ Valeur future de votre capital actuel</strong><br>';
    html += 'Capital actuel: ' + fmt(capAct) + ' $<br>';
    html += 'Rendement annuel: ' + fmt(tauxRendementAvant * 100) + '%<br>';
    html += 'Valeur dans ' + annees + ' ans: <span style="font-size:1.5em;color:#047857;">' + fmt(valeurFuture) + ' $</span><br>';
    var gainRendement = valeurFuture - capAct;
    html += '<small style="color:#6b7280;">Gain gr√¢ce aux rendements: ' + fmt(gainRendement) + ' $</small>';
    html += '</div>';
  }

if(contributionMensuelle > 0) {
  var valeurContributions = valeurFutureAvecContributions - valeurFuture;
  var progAvecContrib = (valeurFutureAvecContributions / capitalNecessaire * 100);
  
  html += '<div class="result-box blue">';
  html += '<strong>üìà Impact de votre √©pargne actuelle</strong><br>';
  html += 'Contribution mensuelle: ' + fmt(contributionMensuelle) + ' $/mois<br>';
  html += 'Valeur future des contributions: <span style="font-size:1.3em;color:#047857;">' + fmt(valeurContributions) + ' $</span><br>';
  html += '<strong style="font-size:1.1em;">Total dans ' + annees + ' ans: ' + fmt(valeurFutureAvecContributions) + ' $</strong><br>';
  
  if(progAvecContrib >= 100) {
    html += '<p style="margin-top:10px;color:#047857;font-weight:bold;">‚úÖ Avec vos contributions actuelles, vous atteindrez votre objectif !</p>';
  } else {
    var manqueEncore = capitalNecessaire - valeurFutureAvecContributions;
    html += '<p style="margin-top:10px;color:#ea580c;">‚ö†Ô∏è Il manquera encore ' + fmt(manqueEncore) + ' $ √† votre objectif.</p>';
  }
  html += '</div>';
}

  html += '<div class="result-box ' + (prog >= 100 ? 'green' : 'orange') + '">Progression vers l\'objectif: ' + prog.toFixed(1) + '%';
  html += '<div class="progress-bar"><div class="progress-fill" style="width:' + Math.min(prog, 100) + '%"></div></div>';
  html += '<p style="margin-top:8px;font-size:0.9em;">Valeur future: ' + fmt(valeurFuture) + ' $<br>Capital n√©cessaire: ' + fmt(capitalNecessaire) + ' $</p></div>';

  // Si capital insuffisant : calcul √©pargne mensuelle requise
  if (prog < 100) {
    var tauxMensuel = tauxRendementAvant / 12;
    var mois = annees * 12;
    var epargneRequise = (tauxMensuel > 0)
      ? ecart / ((Math.pow(1 + tauxMensuel, mois) - 1) / tauxMensuel)
      : ecart / mois;

    html += '<div class="result-box orange">';
    html += '<strong>üìä √âpargne mensuelle n√©cessaire</strong><br>';
    html += 'Il manque: ' + fmt(ecart) + ' $ √† accumuler<br>';
    html += '<span style="font-size:1.8em;font-weight:bold;color:#ea580c;">' + fmt(epargneRequise) + ' $/mois</span><br>';
    html += '<small style="display:block;margin-top:8px;color:#6b7280;">Sur ' + annees + ' ans avec un rendement de ' + fmt(tauxRendementAvant * 100) + '%/an</small>';
    html += '</div>';
  }

  // AFFICHAGE √âPUISEMENT DU CAPITAL
  if (valeurFuture <= 0) {
    html += '<div class="result-box red" style="margin-top:10px;">‚ö†Ô∏è Vous n\'avez actuellement aucun capital disponible pour la retraite.</div>';
  } else if (ageEpuisement) {
    html += '<div class="result-box yellow" style="margin-top:10px;">‚è≥ <strong>Votre capital serait √©puis√© apr√®s environ ' +
            (ageEpuisement - ageRetraite) + ' ans de retraite</strong> (vers ' + ageEpuisement + ' ans).</div>';
  } else {
    html += '<div class="result-box green" style="margin-top:10px;">üí∞ <strong>Votre capital ne s\'√©puiserait pas avant 95 ans</strong> selon vos hypoth√®ses actuelles.</div>';
  }

  document.getElementById('resultat-retraite').innerHTML = html;
}

function calcImmobilier() {
  var revBrut = parseFloat(document.getElementById('revenu-brut-menage').value) || 0;
  // V√©rification si revenu est 0
  if(revBrut === 0) {
    document.getElementById('resultat-immobilier').innerHTML = '<div class="result-box red">‚ö†Ô∏è Veuillez entrer un revenu brut annuel pour calculer votre capacit√© d\'achat immobilier.</div>';
    return;
  }
  var tauxHypo = (parseFloat(document.getElementById('taux-hypo').value) || 5) / 100;
  var amortissement = (parseFloat(document.getElementById('amortissement').value) || 25) * 12;
  var tauxMensuel = tauxHypo / 12;
  var miseDeFondsPct = parseFloat(document.getElementById('mise-de-fonds-pct').value) / 100;
  
  // Calcul des frais SCHL selon la mise de fonds
  function calculerFraisSCHL(prixMaison, miseDeFondsPct) {
    if (miseDeFondsPct >= 0.20) return 0;
    
    var ratioEmprunt = 1 - miseDeFondsPct;
    var tauxPrime;
    
    if (ratioEmprunt > 0.95) tauxPrime = 0.04; // 5% de mise de fonds
    else if (ratioEmprunt > 0.90) tauxPrime = 0.031; // 10% de mise de fonds
    else if (ratioEmprunt > 0.85) tauxPrime = 0.028; // 15% de mise de fonds
    else tauxPrime = 0.024; // 20% de mise de fonds
    
    var montantEmprunt = prixMaison * ratioEmprunt;
    return montantEmprunt * tauxPrime;
  }
  
  // Calcul de la taxe de bienvenue (droits de mutation au Qu√©bec)
  function calculerTaxeBienvenue(prixMaison) {
    var taxe = 0;
    if (prixMaison <= 58900) {
      taxe = prixMaison * 0.005;
    } else if (prixMaison <= 294600) {
      taxe = 58900 * 0.005 + (prixMaison - 58900) * 0.01;
    } else {
      taxe = 58900 * 0.005 + (294600 - 58900) * 0.01 + (prixMaison - 294600) * 0.015;
    }
    return taxe;
  }
  
  // Approche 1 : R√®gle traditionnelle (4x le revenu)
  var prixRegleSimple = revBrut * 4;
  var miseFondsSimple = prixRegleSimple * miseDeFondsPct;
  var empruntSimple = prixRegleSimple - miseFondsSimple;
  var fraisSCHLSimple = calculerFraisSCHL(prixRegleSimple, miseDeFondsPct);
  var empruntTotalSimple = empruntSimple + fraisSCHLSimple;
  var paiementSimple = (empruntTotalSimple * tauxMensuel) / (1 - Math.pow(1 + tauxMensuel, -amortissement));
  var taxeBienvenueSimple = calculerTaxeBienvenue(prixRegleSimple);
  
  // Approche 2 : Capacit√© r√©elle selon les institutions (32% du revenu)
  var maxLog = revBrut * 0.32 / 12;
  var maxTot = revBrut * 0.40 / 12;
  
  // Calcul it√©ratif pour trouver le prix max tenant compte des frais SCHL
  var prixMaxMaison = 0;
  var tentative = revBrut * 4;
  for (var i = 0; i < 10; i++) {
    var miseFondsMax = tentative * miseDeFondsPct;
    var empruntMax = tentative - miseFondsMax;
    var fraisSCHLMax = calculerFraisSCHL(tentative, miseDeFondsPct);
    var empruntTotalMax = empruntMax + fraisSCHLMax;
    var paiementMax = (empruntTotalMax * tauxMensuel) / (1 - Math.pow(1 + tauxMensuel, -amortissement));
    if (paiementMax <= maxLog) {
      prixMaxMaison = tentative;
      tentative *= 1.05;
    } else {
      tentative *= 0.95;
    }
  }
  
  var miseFondsMaxFinal = prixMaxMaison * miseDeFondsPct;
  var fraisSCHLMaxFinal = calculerFraisSCHL(prixMaxMaison, miseDeFondsPct);
  var taxeBienvenueMax = calculerTaxeBienvenue(prixMaxMaison);

  var html = `
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px;">
      
      <div style="background:#e0f2fe;padding:20px;border-radius:12px;border-left:4px solid #0284c7;">
        <h4 style="color:#075985;margin-bottom:15px;">üìò R√®gle traditionnelle (4x revenu)</h4>
        <p style="margin:8px 0;"><strong>Prix sugg√©r√© :</strong> ${fmt(prixRegleSimple)} $</p>
        <p style="margin:8px 0;"><strong>Mise de fonds (${(miseDeFondsPct*100).toFixed(0)}%) :</strong> ${fmt(miseFondsSimple)} $</p>
        ${fraisSCHLSimple > 0 ? `<p style="margin:8px 0;color:#dc2626;"><strong>Frais SCHL :</strong> ${fmt(fraisSCHLSimple)} $</p>` : ''}
        <p style="margin:8px 0;color:#7c3aed;"><strong>Taxe de bienvenue :</strong> ${fmt(taxeBienvenueSimple)} $</p>
        <p style="margin:8px 0;font-size:1.1em;color:#047857;font-weight:bold;">
          üí∞ Paiement mensuel : ${fmt(paiementSimple)} $/mois
        </p>
        <p style="margin-top:10px;font-size:0.85em;color:#64748b;">
          R√®gle empirique simple qui ne tient pas compte du taux d'int√©r√™t actuel.
        </p>
      </div>

      <div style="background:#dcfce7;padding:20px;border-radius:12px;border-left:4px solid #16a34a;">
        <h4 style="color:#15803d;margin-bottom:15px;">üè¶ Capacit√© r√©elle (selon institutions)</h4>
        <p style="margin:8px 0;"><strong>Prix maximal :</strong> ${fmt(prixMaxMaison)} $</p>
        <p style="margin:8px 0;"><strong>Mise de fonds (${(miseDeFondsPct*100).toFixed(0)}%) :</strong> ${fmt(miseFondsMaxFinal)} $</p>
        ${fraisSCHLMaxFinal > 0 ? `<p style="margin:8px 0;color:#dc2626;"><strong>Frais SCHL :</strong> ${fmt(fraisSCHLMaxFinal)} $</p>` : ''}
        <p style="margin:8px 0;color:#7c3aed;"><strong>Taxe de bienvenue :</strong> ${fmt(taxeBienvenueMax)} $</p>
        <p style="margin:8px 0;font-size:1.1em;color:#047857;font-weight:bold;">
          üí∞ Paiement mensuel : ${fmt(maxLog)} $/mois
        </p>
        <p style="margin-top:10px;font-size:0.85em;color:#64748b;">
          Bas√© sur 32% du revenu brut et le taux actuel de ${(tauxHypo * 100).toFixed(2)}%.
        </p>
      </div>
    </div>

    ${miseDeFondsPct < 0.20 ? `
    <div style="background:#fef2f2;padding:18px 20px;border-left:6px solid #dc2626;border-radius:10px;margin:20px 0;overflow:hidden;">
    <div class="warning-box" style="background:#fef2f2;border-left:6px solid #dc2626;padding:25px;border-radius:12px;margin-bottom:30px;overflow:hidden;">
      <h4 style="margin:0 0 10px 0;color:#991b1b;">‚ö†Ô∏è Mise de fonds inf√©rieure √† 20%</h4>
      <p style="margin:0;color:#7f1d1d;font-size:0.95em;line-height:1.7;">
        Avec une mise de fonds de ${(miseDeFondsPct*100).toFixed(0)}%, vous devrez payer une assurance pr√™t hypoth√©caire SCHL. 
        Cette prime est ajout√©e √† votre emprunt et augmente vos paiements mensuels.
      </p>
    </div>
    ` : ''}

    <div style="background:#fef3c7;padding:18px 20px;border-left:6px solid #f59e0b;border-radius:10px;margin:20px 0;">
      <h4 style="margin:0 0 10px 0;color:#92400e;">üí° Comparaison des deux approches</h4>
      <p style="margin:0;color:#78350f;font-size:0.95em;line-height:1.7;">
        ${prixMaxMaison > prixRegleSimple 
          ? `Avec le taux actuel de ${(tauxHypo * 100).toFixed(2)}%, vous pourriez emprunter <strong>${fmt(prixMaxMaison - prixRegleSimple)} $ de plus</strong> que la r√®gle traditionnelle. Attention √† ne pas vous surendetter!`
          : `Avec le taux actuel de ${(tauxHypo * 100).toFixed(2)}%, votre capacit√© r√©elle est <strong>${fmt(prixRegleSimple - prixMaxMaison)} $ inf√©rieure</strong> √† la r√®gle traditionnelle. Les taux √©lev√©s r√©duisent votre pouvoir d'achat.`
        }
      </p>
    </div>
    
    <div style="background:#eef6ff;padding:18px 20px;border-left:6px solid #2563eb;border-radius:10px;margin:20px 0;font-family:system-ui,Segoe UI,Roboto,sans-serif;">
      <h3 style="margin:0;color:#1e3a8a;font-size:1.1em;">üìò R√®gle de qualification hypoth√©caire</h3>
      <p style="margin:10px 0 0 0;color:#374151;font-size:0.95em;line-height:1.7;">
        Les institutions financi√®res appliquent g√©n√©ralement les r√®gles suivantes :
        <br><strong>‚Ä¢ 32 %</strong> du revenu brut peut √™tre consacr√© au logement (<em>paiement hypoth√©caire, taxes, chauffage</em>);
        <br><strong>‚Ä¢ 40 %</strong> du revenu brut peut √™tre consacr√© √† l'ensemble des dettes (<em>logement + autres emprunts</em>).
      </p>
    </div>
  `;

  var prixMaison = parseFloat(document.getElementById('prix-maison').value) || 0;
  if (prixMaison > 0) {
    var miseFonds = prixMaison * miseDeFondsPct;
    var montantEmprunte = prixMaison - miseFonds;
    var fraisSCHL = calculerFraisSCHL(prixMaison, miseDeFondsPct);
    var empruntTotal = montantEmprunte + fraisSCHL;
    var paiementReel = (empruntTotal * tauxMensuel) / (1 - Math.pow(1 + tauxMensuel, -amortissement));
    var taxeBienvenue = calculerTaxeBienvenue(prixMaison);
    var argentRequis = miseFonds + taxeBienvenue;
    var ecartReel = prixMaison - prixMaxMaison;
    var ecartRegle = prixMaison - prixRegleSimple;
    var conformeInstitution = paiementReel <= maxLog;
    
    html += `
      <div class="result-box ${conformeInstitution ? 'green' : 'red'}">
        <h4 style="margin:0 0 10px 0;">Maison envisag√©e : ${fmt(prixMaison)} $</h4>
        <p style="margin:5px 0;"><strong>Mise de fonds (${(miseDeFondsPct*100).toFixed(0)}%) :</strong> ${fmt(miseFonds)} $</p>
        ${fraisSCHL > 0 ? `<p style="margin:5px 0;color:#dc2626;"><strong>Frais SCHL :</strong> ${fmt(fraisSCHL)} $</p>` : ''}
        <p style="margin:5px 0;color:#7c3aed;"><strong>Taxe de bienvenue :</strong> ${fmt(taxeBienvenue)} $</p>
        <p style="margin:5px 0;font-size:1.1em;font-weight:bold;color:#1e40af;"><strong>üíµ Argent requis au comptant :</strong> ${fmt(argentRequis)} $</p>
        <p style="margin:5px 0;"><strong>Paiement mensuel :</strong> ${fmt(paiementReel)} $ / mois</p>
        <p style="margin:10px 0;font-weight:bold;">
          ${conformeInstitution ? '‚úÖ Conforme √† la r√®gle du 32%' : '‚ùå D√©passe la r√®gle du 32% - Risque de refus bancaire'}
        </p>
      </div>
    `;
    
    // Analyse par rapport aux deux approches
    if (conformeInstitution && Math.abs(ecartRegle / prixRegleSimple * 100) < 10) {
      html += `<div class="result-box green">‚úÖ Le prix envisag√© est raisonnable selon les deux approches (r√®gle traditionnelle et capacit√© r√©elle).</div>`;
    } else if (!conformeInstitution) {
      html += `<div class="result-box red">‚ùå Le prix envisag√© d√©passe votre capacit√© de paiement mensuel de ${fmt(paiementReel - maxLog)} $/mois. Les institutions financi√®res risquent de refuser ce montant.</div>`;
    } else {
      html += `<div class="result-box orange">‚ö†Ô∏è Le prix envisag√© utilise toute votre capacit√© d'emprunt. Budget serr√© mais acceptable.</div>`;
    }
  }

  document.getElementById('resultat-immobilier').innerHTML = html;
}

function calcObjectif(){
  var montant=parseFloat(document.getElementById('obj-montant').value)||50000;
  var date=document.getElementById('obj-date').value;
  var tauxAnnuel=(parseFloat(document.getElementById('taux-rendement-objectif').value)||0)/100;
  var tauxMensuel=tauxAnnuel/12;
  
  if(!date){
    document.getElementById('resultat-objectif').innerHTML='Selectionnez une date';
    return;
  }
  
  var aujourd=new Date();
  var dateCible=new Date(date);
  var mois=Math.max(1,(dateCible-aujourd)/(1000*60*60*24*30));
  var epargneAct=DATA.liquidite||0;
  
  var html='<div class="result-box blue">Objectif: '+fmt(montant)+' $<br>Temps: '+Math.round(mois)+' mois<br>Epargne liquide actuelle: '+fmt(epargneAct)+' $</div>';
  
  if(epargneAct>=montant){
    html+='<div class="result-box green">‚úÖ Objectif atteint!</div>';
  } else {
    var manque=montant-epargneAct;
    
    if(tauxMensuel>0){
      // Calcul avec int√©r√™ts compos√©s
      var facteur=Math.pow(1+tauxMensuel,mois);
      var valeurFutureActuelle=epargneAct*facteur;
      var manqueFutur=montant-valeurFutureActuelle;
      
      if(manqueFutur<=0){
        html+='<div class="result-box green">‚úÖ Votre √©pargne actuelle, avec les int√©r√™ts, atteindra '+fmt(valeurFutureActuelle)+' $ √† la date cible. Objectif d√©j√† atteint!</div>';
      } else {
        var mensuel=manqueFutur/(((facteur-1)/tauxMensuel));
        var totalVerse=mensuel*mois;
        var totalInterets=montant-epargneAct-totalVerse;
        
        html+='<div class="result-box orange">Avec un rendement de '+fmt(tauxAnnuel*100)+'% par ann√©e:<br>';
        html+='<span style="font-size:1.8em;font-weight:bold">'+fmt(mensuel)+' $/mois</span><br>';
        html+='<small style="display:block;margin-top:10px;color:#6b7280;">';
        html+='Total vers√©: '+fmt(totalVerse)+' $ | Int√©r√™ts gagn√©s: '+fmt(totalInterets)+' $';
        html+='</small></div>';
      }
      
      // Comparaison sans int√©r√™ts
      var mensuelSansInteret=manque/mois;
      if(mensuel<mensuelSansInteret){
        var economie=mensuelSansInteret-mensuel;
        html+='<div class="result-box blue">üí° Gr√¢ce aux int√©r√™ts compos√©s, vous √©pargnez '+fmt(economie)+' $/mois de moins qu\'un compte sans rendement ('+fmt(mensuelSansInteret)+' $/mois).</div>';
      }
      
    } else {
      // Calcul sans int√©r√™ts (taux = 0%)
      var mensuel=manque/mois;
      html+='<div class="result-box orange">Epargne mensuelle necessaire: <span style="font-size:1.8em">'+fmt(mensuel)+' $/mois</span></div>';
    }
  }
  
  document.getElementById('resultat-objectif').innerHTML=html;
}


function genererDiagnostic(){
if(!DATA.totalA && !DATA.totalP && !DATA.revenuTotal){
document.getElementById('diagnostic-global').innerHTML='Entrez vos donnees';return;
}
var score=0;
var mois=(DATA.cb||0)/(DATA.totalD||1);
var taux=parseFloat(DATA.taux)||0;
var ratio=DATA.totalA>0?(DATA.totalP/DATA.totalA*100):100;
var ratioDetteRevenu=DATA.revenuTotal>0?(DATA.totalD/DATA.revenuTotal*100):100;

var pointsFaibles = [];
var recommandations = [];

var html='<div class="result-box '+(mois>=6?'green':mois>=3?'orange':'red')+'">Fonds urgence: '+mois.toFixed(1)+' mois';
if(mois>=6){
  html+=' - Excellent';
  score++;
}else if(mois>=3){
  html+=' - Correct';
}else{
  pointsFaibles.push("fonds d'urgence insuffisant");
if(mois < 1) {
  recommandations.push("üö® <strong>Fonds d'urgence :</strong> Les experts financiers recommandent g√©n√©ralement un minimum de 1 000 $ en urgence pour faire face aux impr√©vus.");
} else {
  recommandations.push("üí∞ <strong>Fonds d'urgence :</strong> Selon les principes financiers reconnus, un fonds d'urgence devrait couvrir 3-6 mois de d√©penses (" + fmt((DATA.totalD||0)*3) + " $ √† " + fmt((DATA.totalD||0)*6) + " $).");
}
}
html+='</div>';

html+='<div class="result-box '+(taux>=20?'green':taux>=10?'orange':'red')+'">Taux epargne: '+taux+'%';
if(taux>=20){
  html+=' - Excellent';
  score++;
}else if(taux>=10){
  html+=' - Correct';
}else{
  pointsFaibles.push("taux d'√©pargne faible");
  if(DATA.revenuTotal>0){
  var manqueEpargne = (DATA.revenuTotal * 0.20) - DATA.epargne;
  recommandations.push("üìä <strong>Taux d'√©pargne :</strong> La r√®gle g√©n√©rale en finances personnelles sugg√®re un taux d'√©pargne de 20%. Pour atteindre ce niveau, il faudrait √©pargner " + fmt(manqueEpargne) + " $/mois de plus. Astuce courante : automatiser l'√©pargne d√®s la r√©ception du revenu.");
}
}
if(taux<20 && DATA.revenuTotal>0){
  html+='<p style="font-size:0.9em;margin-top:5px;">üí° Pour atteindre 20%, augmentez votre √©pargne de ' + fmt((DATA.revenuTotal * 0.20) - DATA.epargne) + ' $/mois</p>';
}
html+='</div>';

html+='<div class="result-box '+(DATA.totalA==0&&DATA.totalP>0?'red':ratio<=30?'green':ratio<=50?'orange':'red')+'">Endettement: '+(DATA.totalA>0?ratio.toFixed(1)+'%':'N/A');
if(DATA.totalA==0&&DATA.totalP>0){
  html+=' - Critique: dettes sans actifs';
  pointsFaibles.push("dettes sans actifs");
  recommandations.push("üö® <strong>Situation critique :</strong> Vos dettes d√©passent vos actifs actuels. Les conseillers financiers recommandent g√©n√©ralement d'√©tablir un plan de remboursement structur√© en commen√ßant par les dettes √† taux d'int√©r√™t √©lev√©. Consultez un conseiller en cr√©dit ou un planificateur financier.");
}else if(ratio<=30){
  html+=' - Excellent';
  score++;
}else if(ratio<=50){
  html+=' - Mod√©r√©';
}else{
  pointsFaibles.push("endettement √©lev√©");
  recommandations.push("üí≥ <strong>Endettement :</strong> Votre ratio dettes/actifs est de " + ratio.toFixed(1) + "%. Les experts financiers recommandent g√©n√©ralement de maintenir ce ratio sous 30%. La strat√©gie couramment conseill√©e est de rembourser en priorit√© les dettes √† taux d'int√©r√™t √©lev√© (cartes de cr√©dit, marges).");
}
html+='</div>';

if(DATA.revenuTotal > 0) {
 html+='<div class="result-box '+(ratioDetteRevenu<=35?'green':ratioDetteRevenu<=50?'orange':'red')+'">Ratio dettes/revenus: '+ratioDetteRevenu.toFixed(1)+'%';
if(ratioDetteRevenu<=35){
  html+=' - Excellent';
  score++;
}else if(ratioDetteRevenu<=50){
  html+=' - Acceptable';

}else{
  html+=' - Trop √©lev√©';
  pointsFaibles.push("ratio dettes/revenus trop √©lev√©");
  recommandations.push("‚ö†Ô∏è <strong>Dettes/revenus :</strong> Votre ratio est de " + ratioDetteRevenu.toFixed(1) + "% (les institutions financi√®res recommandent g√©n√©ralement un ratio sous 35%). Les strat√©gies courantes incluent la r√©duction des d√©penses fixes ou l'augmentation des revenus.");
}

html+='</div>';
}
html+='</div>';

html+='<div class="result-box '+(DATA.vn>0?'green':'red')+'">Valeur nette: '+fmt(DATA.vn)+' $';
if(DATA.vn>100000){
  score+=2;
  html+=' - Excellent';
}else if(DATA.vn>50000){
  score++;
  html+=' - Bon d√©part';
}else if(DATA.vn>0){
  html+=' - En construction';
}else{
  pointsFaibles.push("valeur nette n√©gative");
  recommandations.push("üìâ <strong>Valeur nette n√©gative :</strong> Vos dettes d√©passent actuellement vos actifs. Les conseillers financiers recommandent g√©n√©ralement une approche combin√©e : remboursement structur√© des dettes et accumulation progressive d'√©pargne. Un plan financier personnalis√© avec un professionnel peut aider √† prioriser ces actions.");
}

html+='</div>';

html+='<div class="result-box blue">Score: '+score+'/6';
html+='<div class="progress-bar"><div class="progress-fill" style="width:'+Math.round(score/6*100)+'%"></div></div></div>';

// Commentaire selon le score
if(score>=5){
  html+='<div style="background:#d1fae5;padding:15px;border-radius:8px;margin-top:15px;color:#065f46;">üéâ Excellente sant√© financi√®re ! Continuez sur cette lanc√©e.</div>';
}else if(score>=3){
  html+='<div style="background:#dbeafe;padding:15px;border-radius:8px;margin-top:15px;color:#1e40af;">üëç Bonne base financi√®re, mais place √† am√©lioration.';
  if(pointsFaibles.length>0){
    html+='<br><small>Points √† am√©liorer : ' + pointsFaibles.join(', ') + '.</small>';
  }
  html+='</div>';

}else if(score>=1){
  html+='<div style="background:#fed7aa;padding:15px;border-radius:8px;margin-top:15px;color:#92400e;"><h4 style="color:#92400e;margin:0 0 10px 0;">‚ö†Ô∏è Situation √† am√©liorer</h4>';
  html+='<p style="margin:0;color:#374151;line-height:1.6;">Votre situation financi√®re pr√©sente plusieurs aspects √† am√©liorer. Ne vous d√©couragez pas ! Les experts recommandent une approche progressive : discipline budg√©taire et plan d\'action structur√©. Consultez un conseiller financier pour √©tablir des priorit√©s adapt√©es √† votre situation.</p>';
}else{
  html+='<div style="background:#fee2e2;padding:15px;border-radius:8px;margin-top:15px;border-left:4px solid #dc2626;"><h4 style="color:#991b1b;margin:0 0 10px 0;">üö® Situation n√©cessitant attention</h4>';
  html+='<p style="margin:0;color:#374151;line-height:1.6;">Votre situation financi√®re n√©cessite une attention particuli√®re. Les principes de base incluent : √©tablir un budget r√©aliste, identifier les d√©penses r√©ductibles et cr√©er un plan de remboursement. <strong>Il est fortement recommand√© de consulter un conseiller financier autoris√© ou un conseiller en cr√©dit</strong> pour vous accompagner.</p>';
}

// Recommandations personnalis√©es
if(recommandations.length>0){
  html+='<div style="background:#eff6ff;padding:20px;border-radius:10px;margin-top:15px;">';
  html+='<h4 style="color:#1e40af;margin:0 0 15px 0;">üìã Recommandations personnalis√©es</h4>';
  html+='<div style="color:#374151;line-height:1.8;">';
  for(var i=0;i<recommandations.length;i++){
    html+='<p style="margin:8px 0;">'+recommandations[i]+'</p>';
  }
  html+='</div></div>';
}

// Comparaison avec les statistiques qu√©b√©coises
html+='<div style="background:#f0fdf4;padding:20px;border-radius:10px;margin-top:20px;border-left:4px solid #10b981;">';
html+='<h4 style="color:#047857;margin:0 0 15px 0;">üìä Comparaison avec les statistiques qu√©b√©coises</h4>';

// Taux d'√©pargne
if(taux > 0) {
  var tauxMoyen = 5;
  html+='<div style="margin-bottom:15px;padding:10px;background:white;border-radius:6px;">';
  html+='<strong>Taux d\'√©pargne</strong><br>';
  html+='<span style="font-size:0.9em;color:#6b7280;">Vous : <strong style="color:#2563eb;">' + taux + '%</strong> | Moyenne qu√©b√©coise : ~5-6%</span><br>';
  if(taux >= 15) {
    html+='<span style="color:#047857;">‚úÖ Excellent ! Vous √©pargnez bien plus que la moyenne.</span>';
  } else if(taux >= tauxMoyen) {
    html+='<span style="color:#047857;">üëç Au-dessus de la moyenne qu√©b√©coise.</span>';
  } else {
    html+='<span style="color:#ea580c;">‚ö†Ô∏è Sous la moyenne. Essayez d\'augmenter progressivement.</span>';
  }
  html+='</div>';
}

// Ratio dette/actifs
if(DATA.totalA > 0) {
  html+='<div style="margin-bottom:15px;padding:10px;background:white;border-radius:6px;">';
  html+='<strong>Endettement (dette/actifs)</strong><br>';
  html+='<span style="font-size:0.9em;color:#6b7280;">Vous : <strong style="color:#2563eb;">' + ratio.toFixed(1) + '%</strong> | Recommand√© : sous 30%</span><br>';
  if(ratio <= 20) {
    html+='<span style="color:#047857;">‚úÖ Excellent niveau d\'endettement.</span>';
  } else if(ratio <= 30) {
    html+='<span style="color:#047857;">üëç Endettement sain.</span>';
  } else {
    html+='<span style="color:#ea580c;">‚ö†Ô∏è Au-dessus du niveau recommand√©.</span>';
  }
  html+='</div>';
}

// Fonds d'urgence
html+='<div style="margin-bottom:15px;padding:10px;background:white;border-radius:6px;">';
html+='<strong>Fonds d\'urgence</strong><br>';
html+='<span style="font-size:0.9em;color:#6b7280;">Vous : <strong style="color:#2563eb;">' + mois.toFixed(1) + ' mois</strong> | Environ 40% des Canadiens n\'ont pas 3 mois d\'√©pargne</span><br>';
if(mois >= 6) {
  html+='<span style="color:#047857;">‚úÖ Vous faites partie des 30% les mieux pr√©par√©s !</span>';
} else if(mois >= 3) {
  html+='<span style="color:#047857;">üëç Mieux que 60% des Canadiens.</span>';
} else {
  html+='<span style="color:#ea580c;">‚ö†Ô∏è 60% des Canadiens ont au moins 3 mois. Continuez √† b√¢tir votre fonds.</span>';
}
html+='</div>';

// Valeur nette (optionnel - si l'utilisateur veut partager son √¢ge)
html+='<div style="margin-bottom:15px;padding:10px;background:white;border-radius:6px;">';
html+='<strong>Valeur nette</strong><br>';
html+='<span style="font-size:0.9em;color:#6b7280;">Vous : <strong style="color:#2563eb;">' + fmt(DATA.vn) + ' $</strong></span><br>';
html+='<span style="font-size:0.85em;color:#6b7280;">Valeur nette m√©diane au Canada (selon l\'√¢ge) :<br>';
html+='‚Ä¢ Moins de 35 ans : ~50 000$<br>';
html+='‚Ä¢ 35-44 ans : ~250 000$<br>';
html+='‚Ä¢ 45-54 ans : ~500 000$<br>';
html+='‚Ä¢ 55-64 ans : ~850 000$</span>';
html+='</div>';

// Liens vers sources officielles
html+='<div style="margin-top:15px;padding-top:15px;border-top:1px solid #d1fae5;">';
html+='<p style="font-size:0.85em;color:#6b7280;margin:0 0 8px 0;"><strong>üìö Sources officielles pour en savoir plus :</strong></p>';
html+='<ul style="font-size:0.85em;color:#6b7280;margin:0;padding-left:20px;line-height:1.8;">';
html+='<li><a href="https://www150.statcan.gc.ca/n1/fr/subjects/revenus_pensions_depenses_et_richesse" target="_blank" style="color:#2563eb;">Statistique Canada - Revenus et richesse</a></li>';
html+='<li><a href="https://www.banqueducanada.ca/taux/indicateurs/capacite-et-besoins-financiers/ratios-dette-menages/" target="_blank" style="color:#2563eb;">Banque du Canada - Endettement des m√©nages</a></li>';
html+='<li><a href="https://www.canada.ca/fr/agence-consommation-matiere-financiere/programmes/litteratie-financiere.html" target="_blank" style="color:#2563eb;">Gouvernement du Canada - Litt√©ratie financi√®re</a></li>';
html+='</ul>';
html+='</div>';

html+='</div>';

document.getElementById('diagnostic-global').innerHTML=html;
document.getElementById('diagnostic-global').innerHTML=html;

}

function exporterCSV() {
  const rows = [
    ["Section","Cl√©","Valeur"],
    ["Actifs","Compte bancaire", document.getElementById('cb').value],
    ["Actifs","CELI", document.getElementById('celi').value],
    ["Actifs","Compte non enregistr√©", document.getElementById('cne').value],
    ["Actifs","REER", document.getElementById('reer').value],
    ["Actifs","Immobilisations", document.getElementById('immob').value],
    ["Actifs","Autres actifs", document.getElementById('autre-actif').value],
    ["Passifs","Cartes de cr√©dit", document.getElementById('cc').value],
    ["Passifs","Marge de cr√©dit", document.getElementById('mc').value],
    ["Passifs","Pr√™t auto", document.getElementById('pa').value],
    ["Passifs","Hypoth√®que", document.getElementById('hypo').value],
    ["Passifs","Autres passifs", document.getElementById('autre-passif').value],
    ["R√©sum√©","Total actifs", DATA.totalA||0],
    ["R√©sum√©","Total passifs", DATA.totalP||0],
    ["R√©sum√©","Valeur nette", DATA.vn||0],
    ["Budget","Revenu mensuel net", document.getElementById('revenu').value],
    ["Budget","Revenu de loyer", document.getElementById('rev-loyer').value],
    ["Budget","Autre revenu", document.getElementById('autre-revenu').value],
    ["Budget","Revenus totaux", DATA.revenuTotal||0],
    ["Budget","Total d√©penses", DATA.totalD||0],
    ["Budget","√âpargne mensuelle", DATA.epargne||0],
    ["Budget","Taux d'√©pargne (%)", DATA.taux||0],
    ["Imp√¥ts","Revenu brut annuel", document.getElementById('rb').value],
    ["Imp√¥ts","Contribution REER", document.getElementById('cr').value],
    ["Imp√¥ts","Autres d√©ductions", document.getElementById('ad').value],
    ["Objectifs","Montant cible", document.getElementById('obj-montant').value],
    ["Objectifs","Date cible", document.getElementById('obj-date').value],
  ];

  let csvContent = rows.map(e => e.join(";")).join("\n");
  const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.setAttribute("href", url);
  link.setAttribute("download", "finance_personnelle.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Gestion des dettes - Version propre
var listeDettes = [];
var idCompteur = 0;

function ajouterLigneDette() {
  idCompteur++;
  var id = idCompteur;
  
  listeDettes.push({
    id: id,
    nom: '',
    solde: 0,
    taux: 0,
    paiementMin: 0
  });
  
  afficherDettes();
}

function supprimerLigneDette(id) {
  listeDettes = listeDettes.filter(function(d) { return d.id !== id; });
  afficherDettes();
  calculerStrategies();
}

function afficherDettes() {
  var html = '';
  
  if(listeDettes.length === 0) {
    html = '<p style="color:#6b7280;font-style:italic;">Aucune dette ajout√©e. Cliquez sur "Ajouter une dette" pour commencer.</p>';
  }
  
  for(var i = 0; i < listeDettes.length; i++) {
    var dette = listeDettes[i];
    html += '<div style="background:#f9fafb;padding:20px;border-radius:8px;margin-bottom:15px;border:1px solid #e5e7eb;">';
    html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">';
    html += '<h4 style="margin:0;color:#374151;">Dette #' + dette.id + '</h4>';
    html += '<button onclick="supprimerLigneDette(' + dette.id + ')" style="background:#ef4444;color:white;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:0.9em;">Supprimer</button>';
    html += '</div>';
    
    html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">';
    
    html += '<div>';
    html += '<label style="display:block;font-size:0.875em;font-weight:500;color:#374151;margin-bottom:8px;">Type de dette</label>';
    html += '<select id="nom-' + dette.id + '" onchange="mettreAJourDette(' + dette.id + ')" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;">';
    html += '<option value="Carte de cr√©dit">Carte de cr√©dit</option>';
    html += '<option value="Pr√™t auto">Pr√™t auto</option>';
    html += '<option value="Marge de cr√©dit">Marge de cr√©dit</option>';
    html += '<option value="Pr√™t personnel">Pr√™t personnel</option>';
    html += '<option value="Pr√™t √©tudiant">Pr√™t √©tudiant</option>';
    html += '<option value="Autre">Autre</option>';
    html += '</select>';
    html += '</div>';
    
    html += '<div>';
    html += '<label style="display:block;font-size:0.875em;font-weight:500;color:#374151;margin-bottom:8px;">Solde actuel ($)</label>';
    html += '<input type="number" id="solde-' + dette.id + '" value="' + dette.solde + '" onchange="mettreAJourDette(' + dette.id + ')" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;" min="0">';
    html += '</div>';
    
    html += '<div>';
    html += '<label style="display:block;font-size:0.875em;font-weight:500;color:#374151;margin-bottom:8px;">Taux d\'int√©r√™t annuel (%)</label>';
    html += '<input type="number" id="taux-' + dette.id + '" value="' + dette.taux + '" onchange="mettreAJourDette(' + dette.id + ')" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;" min="0" step="0.1">';
    html += '</div>';
    
    html += '<div>';
    html += '<label style="display:block;font-size:0.875em;font-weight:500;color:#374151;margin-bottom:8px;">Paiement minimum ($)</label>';
    html += '<input type="number" id="paiementMin-' + dette.id + '" value="' + dette.paiementMin + '" onchange="mettreAJourDette(' + dette.id + ')" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;" min="0">';
    html += '</div>';
    
    html += '</div>';
    html += '</div>';
  }
  
  document.getElementById('liste-dettes-container').innerHTML = html;
}

function mettreAJourDette(id) {
  for(var i = 0; i < listeDettes.length; i++) {
    if(listeDettes[i].id === id) {
      listeDettes[i].nom = document.getElementById('nom-' + id).value;
      listeDettes[i].solde = parseFloat(document.getElementById('solde-' + id).value) || 0;
      listeDettes[i].taux = parseFloat(document.getElementById('taux-' + id).value) || 0;
      listeDettes[i].paiementMin = parseFloat(document.getElementById('paiementMin-' + id).value) || 0;
      break;
    }
  }
}

function calculerStrategies() {
  // V√©rifier qu'il y a des dettes
  if(listeDettes.length === 0) {
    document.getElementById('resultats-strategies').innerHTML = '<div class="card"><p style="color:#6b7280;">Ajoutez au moins une dette pour voir les calculs.</p></div>';
    return;
  }
  
  // V√©rifier que toutes les dettes ont des valeurs valides
  var dettesValides = [];
  for(var i = 0; i < listeDettes.length; i++) {
    if(listeDettes[i].solde > 0) {
      dettesValides.push({
        nom: listeDettes[i].nom,
        solde: listeDettes[i].solde,
        taux: listeDettes[i].taux,
        paiementMin: listeDettes[i].paiementMin
      });
    }
  }
  
  if(dettesValides.length === 0) {
    document.getElementById('resultats-strategies').innerHTML = '<div class="card"><p style="color:#dc2626;">Entrez au moins une dette avec un solde sup√©rieur √† 0.</p></div>';
    return;
  }
  
  var paiementExtra = parseFloat(document.getElementById('paiement-extra').value) || 0;
 // V√©rifier si le paiement extra est suffisant
var totalMin = 0;
var totalInteretsMensuels = 0;
for(var i = 0; i < dettesValides.length; i++) {
  totalMin += dettesValides[i].paiementMin;
  totalInteretsMensuels += dettesValides[i].solde * (dettesValides[i].taux / 100 / 12);
}

if(paiementExtra <= 0) {
  var html = '<div class="card" style="background:#fee2e2;border-left:4px solid #dc2626;margin-top:20px;">';
  html += '<h3 style="color:#991b1b;">‚ö†Ô∏è Paiement suppl√©mentaire requis</h3>';
  html += '<p>Avec seulement les paiements minimums (' + fmt(totalMin) + ' $/mois), vos dettes ne seront jamais compl√®tement rembours√©es car les int√©r√™ts s\'accumulent.</p>';
  html += '<p style="margin-top:10px;"><strong>Vous devez ajouter un paiement mensuel suppl√©mentaire d\'au moins ' + fmt(Math.ceil(totalInteretsMensuels - totalMin + 100)) + ' $/mois</strong> pour r√©duire progressivement vos dettes.</p>';
  html += '</div>';
  document.getElementById('resultats-strategies').innerHTML = html;
  return;
}

  // Calculer les deux strat√©gies
  var avalanche = simulerStrategie(dettesValides, paiementExtra, 'avalanche');
  var bouleNeige = simulerStrategie(dettesValides, paiementExtra, 'boule');
  
  // Afficher les r√©sultats
  afficherComparaison(avalanche, bouleNeige, dettesValides, paiementExtra);
}

function simulerStrategie(dettes, paiementExtra, type) {
  // Copier et trier les dettes UNE SEULE FOIS au d√©but
  var dettesCopie = [];
  for(var i = 0; i < dettes.length; i++) {
    dettesCopie.push({
      nom: dettes[i].nom,
      solde: dettes[i].solde,
      taux: dettes[i].taux,
      paiementMin: dettes[i].paiementMin
    });
  }
  
  // Trier selon la strat√©gie (UNE SEULE FOIS)
  if(type === 'avalanche') {
    dettesCopie.sort(function(a, b) { return b.taux - a.taux; });
  } else {
    dettesCopie.sort(function(a, b) { return a.solde - b.solde; });
  }
  
  var mois = 0;
  var interetsTotal = 0;
  var ordreRemboursement = [];
  
  while(dettesCopie.length > 0 && mois < 600) {
    mois++;
    
    // 1. Ajouter les int√©r√™ts mensuels
    for(var i = 0; i < dettesCopie.length; i++) {
      var tauxMensuel = dettesCopie[i].taux / 100 / 12;
      var interetsMois = dettesCopie[i].solde * tauxMensuel;
      dettesCopie[i].solde += interetsMois;
      interetsTotal += interetsMois;
    }
    
    // 2. Payer les minimums sur toutes les dettes
    for(var i = 0; i < dettesCopie.length; i++) {
      var paiement = Math.min(dettesCopie[i].paiementMin, dettesCopie[i].solde);
      dettesCopie[i].solde -= paiement;
    }
    
    // 3. Appliquer le paiement extra sur la PREMI√àRE dette (prioritaire)
    if(paiementExtra > 0 && dettesCopie.length > 0) {
      var paiement = Math.min(paiementExtra, dettesCopie[0].solde);
      dettesCopie[0].solde -= paiement;
    }
    
    // 4. Enlever les dettes pay√©es (de la fin vers le d√©but pour √©viter les probl√®mes d'index)
    for(var i = dettesCopie.length - 1; i >= 0; i--) {
      if(dettesCopie[i].solde < 0.01) {
        ordreRemboursement.push({
          nom: dettesCopie[i].nom,
          mois: mois
        });
        dettesCopie.splice(i, 1);
      }
    }
  }
  
  return {
    mois: mois,
    annees: Math.round(mois / 12 * 10) / 10,
    interetsTotal: interetsTotal,
    ordre: ordreRemboursement
  };
}

function afficherComparaison(avalanche, bouleNeige, dettes, paiementExtra) {
  var totalDettes = 0;
  var totalMin = 0;
  
  for(var i = 0; i < dettes.length; i++) {
    totalDettes += dettes[i].solde;
    totalMin += dettes[i].paiementMin;
  }
  
  var html = '';
  
  // R√©sum√© situation
  html += '<div class="card" style="background:#f0f9ff;margin-top:20px;">';
  html += '<h3 style="color:#1e40af;">üìã Votre situation</h3>';
  html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px;">';
  html += '<div><p style="color:#6b7280;font-size:0.9em;margin:0;">Total des dettes</p><p style="font-size:1.5em;font-weight:bold;color:#1f2937;margin:5px 0 0 0;">' + fmt(totalDettes) + ' $</p></div>';
  html += '<div><p style="color:#6b7280;font-size:0.9em;margin:0;">Paiements minimums</p><p style="font-size:1.5em;font-weight:bold;color:#1f2937;margin:5px 0 0 0;">' + fmt(totalMin) + ' $/mois</p></div>';
  html += '<div><p style="color:#6b7280;font-size:0.9em;margin:0;">Paiement extra</p><p style="font-size:1.5em;font-weight:bold;color:#047857;margin:5px 0 0 0;">' + fmt(paiementExtra) + ' $/mois</p></div>';
  html += '<div><p style="color:#6b7280;font-size:0.9em;margin:0;">Total mensuel</p><p style="font-size:1.5em;font-weight:bold;color:#2563eb;margin:5px 0 0 0;">' + fmt(totalMin + paiementExtra) + ' $/mois</p></div>';
  html += '</div>';
  html += '</div>';
  
  // Comparaison des deux m√©thodes
  html += '<div class="grid-2" style="margin-top:20px;">';
  
  // Avalanche
  html += '<div class="card" style="border-left:4px solid #dc2626;">';
  html += '<h3 style="color:#dc2626;">üî• M√©thode Avalanche</h3>';
  html += '<p style="background:#fef3c7;padding:10px;border-radius:6px;font-size:0.9em;margin-bottom:15px;">Priorit√© aux <strong>taux d\'int√©r√™t √©lev√©s</strong></p>';
  html += '<div class="result-box blue">Dur√©e: <strong>' + avalanche.mois + ' mois</strong> (' + avalanche.annees + ' ans)</div>';
  html += '<div class="result-box red">Int√©r√™ts pay√©s: <strong>' + fmt(avalanche.interetsTotal) + ' $</strong></div>';
  html += '</div>';
  
  // Boule de neige
  html += '<div class="card" style="border-left:4px solid #2563eb;">';
  html += '<h3 style="color:#2563eb;">‚ùÑÔ∏è M√©thode Boule de neige</h3>';
  html += '<p style="background:#dbeafe;padding:10px;border-radius:6px;font-size:0.9em;margin-bottom:15px;">Priorit√© aux <strong>petits soldes</strong> (motivation)</p>';
  html += '<div class="result-box blue">Dur√©e: <strong>' + bouleNeige.mois + ' mois</strong> (' + bouleNeige.annees + ' ans)</div>';
  html += '<div class="result-box red">Int√©r√™ts pay√©s: <strong>' + fmt(bouleNeige.interetsTotal) + ' $</strong></div>';
  html += '</div>';
  
  html += '</div>';
  
  // Verdict
  var diff = bouleNeige.interetsTotal - avalanche.interetsTotal;
  var diffMois = bouleNeige.mois - avalanche.mois;
  
  html += '<div class="card" style="margin-top:20px;">';
  html += '<h3>üèÜ Verdict</h3>';
  
  if(Math.abs(diff) < 10) {
    html += '<div class="result-box blue">Les deux m√©thodes donnent des r√©sultats tr√®s similaires. Choisissez celle qui vous motive le plus !</div>';
  } else if(diff > 0) {
    html += '<div class="result-box green">';
    html += '‚úÖ La m√©thode <strong>Avalanche</strong> vous fait √©conomiser <strong>' + fmt(diff) + ' $</strong> en int√©r√™ts ';
    html += 'et vous lib√®re <strong>' + Math.abs(diffMois) + ' mois plus t√¥t</strong> (' + Math.round(Math.abs(diffMois)/12*10)/10 + ' ans).';
    html += '</div>';
  } else {
    html += '<div class="result-box green">';
    html += '‚úÖ La m√©thode <strong>Boule de neige</strong> est l√©g√®rement avantageuse dans votre cas.';
    html += '</div>';
  }
  
html += '<div style="background:#f0f9ff;padding:20px;border-radius:10px;margin-top:20px;border-left:4px solid #2563eb;">';
html += '<h4 style="margin:0 0 15px 0;color:#1e40af;">üìã Plan d\'action recommand√©</h4>';

var meilleure = (diff >= 0) ? avalanche : bouleNeige;
var methodeNom = (diff >= 0) ? 'Avalanche' : 'Boule de neige';

html += '<p style="margin:0 0 10px 0;"><strong>Suivez la m√©thode ' + methodeNom + ' :</strong></p>';
html += '<ol style="margin:0;padding-left:20px;line-height:2;">';

for(var i = 0; i < meilleure.ordre.length; i++) {
  html += '<li><strong>' + meilleure.ordre[i].nom + '</strong> - sera rembours√©e au mois ' + meilleure.ordre[i].mois;
  if(i === 0) {
    html += ' <span style="color:#047857;font-weight:bold;">‚Üê Concentrez votre paiement suppl√©mentaire ici en premier</span>';
  }
  html += '</li>';
}

html += '</ol>';
html += '<p style="margin:15px 0 0 0;padding-top:15px;border-top:1px solid #bfdbfe;color:#6b7280;font-size:0.9em;">';
html += 'üí° <strong>Astuce :</strong> Continuez √† payer les minimums sur toutes les dettes, mais concentrez votre paiement suppl√©mentaire de ' + fmt(paiementExtra) + ' $/mois sur la dette prioritaire selon cet ordre.';
html += '</p>';
html += '</div>';

html += '</div>';

  document.getElementById('resultats-strategies').innerHTML = html;
}

</script>
</body>
</html>
